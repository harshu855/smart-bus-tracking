<!DOCTYPE html>
<html>
<head>
    <title>Driver Tracking</title>
    <style>
        body {
            font-family: Arial;
            text-align: center;
            padding: 30px;
            background: #f4f7fc;
        }
        h2 {
            color: #004aad;
        }
        select, button {
            font-size: 18px;
            padding: 10px;
            margin-top: 15px;
        }
        button {
            background: #004aad;
            color: white;
            border: none;
            border-radius: 6px;
        }
        .status {
            margin-top: 15px;
            font-size: 16px;
            color: green;
        }
    </style>
</head>

<body>

<h2>Driver Location Tracker</h2>

<p>Select Bus:</p>
<select id="busSelect">
    <option value="bus1">Bus 1</option>
    <option value="bus2">Bus 2</option>
</select>

<br>
<button id="trackBtn">Start Tracking</button>

<p class="status" id="status">Not connected</p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyCesQtDSP9MMYPpb075z7Qjru1Hp5kYxrw",
    authDomain: "smartschoolbus-46e3c.firebaseapp.com",
    databaseURL: "https://smartschoolbus-46e3c-default-rtdb.firebaseio.com",
    projectId: "smartschoolbus-46e3c",
    storageBucket: "smartschoolbus-46e3c.firebasestorage.app",
    messagingSenderId: "800303812272",
    appId: "1:800303812272:web:e74f40e821954c333ab575"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const trackBtn = document.getElementById("trackBtn");
const statusText = document.getElementById("status");
const busSelect = document.getElementById("busSelect");

let watchId = null;
let tracking = false;

trackBtn.onclick = () => {
    if (!tracking) startTracking();
    else stopTracking();
};

function startTracking() {
    if (!navigator.geolocation) {
        alert("GPS not supported");
        return;
    }

    const busId = busSelect.value;
    tracking = true;
    trackBtn.textContent = "Stop Tracking";
    statusText.textContent = "Connected to " + busId.toUpperCase();

    watchId = navigator.geolocation.watchPosition(pos => {
        update(ref(db, "buses/" + busId), {
            lat: pos.coords.latitude,
            lng: pos.coords.longitude,
            lastUpdated: Date.now()
        });
    });
}

function stopTracking() {
    tracking = false;
    trackBtn.textContent = "Start Tracking";
    statusText.textContent = "Not connected";
    navigator.geolocation.clearWatch(watchId);
}
</script>

</body>
</html>
